<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width", initial-scale="1.0"/>
		<meta http-equiv="X-UA-Compatible" content="ie=edge"/>
		<title>Audi_R8</title>
		

		<style>
			body
			{
				margin: 0;
				padding:0; 
				overflow: hidden;
			}
			

			canvas
			{
				width: 100%;
   				height: 100%;
			}
			
			.sceneTag_holder
			{
				position: absolute;
				width: 100%;
				height: 100%;
				pointer-events: none;
			}

			.sceneTag
			{
				
				position: absolute;
				display: flex;
				justify-content: center;
				width: 36px;
				height: 36px;
				background-image: url(https://fimawork.droppages.net/icon/Magnifier_002_white.png);
				background-size: 100% 100%;
				transform: translate(-50%, -50%); /* 將Anchor由TopLeft改到中心  */
				pointer-events: fill;
				background-color: rgba(255, 255, 255, 0);
				border-radius:50% 50%;
			}

			.title
			{
				margin: auto;
				text-align: center;
				font-family:Arial;
				font-weight:lighter;
				font-size: 12px;
				color: rgba(255, 255, 255, 0.9);
			}

			@media screen and (max-width:768px)
			{
				.sceneTag
				{
					width: 30px;
					height: 30px;
				}

			}

			
		</style>

        
        
	</head>
	<body>   
	
		<div class="sceneTag_holder">
			<div id="sceneTag_01">
				<div class="sceneTag"></div>
			</div>
			<!--<div id="sceneTag_02">
				<div class="sceneTag"></div>
			</div>-->
			<div id="sceneTag_03">
				<div class="sceneTag"></div>
			</div>
			<div id="sceneTag_04">
				<div class="sceneTag"></div>
			</div>
			<!--<div id="sceneTag_05">
				<div class="sceneTag"></div>
			</div>-->
			<div id="sceneTag_06">
				<div class="sceneTag"></div>
			</div>
		</div>
		
	
	<script src="./js/three.js"></script> 

	<!--<script src="./jsm/threex.domevents/threex.domevents.js"></script> -->

	<script src="./LevelManager.js"></script> 

	<script type="importmap">
		{
			"imports": {
				"three": "./build/three.module.js",				
				"three/addons/": "./jsm/"             
			}
		}

		
		
	</script>



	<script>


		const params = {
				envMap: 'HDR',
				roughness: 0.05,
				metalness: 0.6,
				exposure: 2,
				debug: false
			};//redPaint

		const params_01 = {
				envMap: 'HDR',
				roughness: 0.05,
				metalness: 0.6,
				exposure: 2,
				debug: false
			};//blackWindwo

		const params_02 = {
				envMap: 'HDR',
				roughness: 0.1,
				metalness: 1,
				exposure: 1,
				debug: false
			};//後照鏡

		const params_03 = {
				envMap: 'HDR',
				roughness: 0.1,
				metalness: 1,
				exposure: 1,
				debug: false
			};//後照鏡

		const params_04 = {
				envMap: 'HDR',
				roughness: 0.1,
				metalness: 0.9,
				exposure: 2,
				debug: false
			};//輪框、排氣管
			
		const redPaint = new THREE.MeshStandardMaterial( {
				color: 0x700000,
				metalness: 0.3,
				roughness: 0.3
			} );

		const navyblue = new THREE.MeshPhysicalMaterial( {
					color: 0x0A1F52, metalness: 1.0, roughness: 0.5, clearcoat: 1.0, clearcoatRoughness: 0.03
				} );

		

		const darkgray = new THREE.MeshStandardMaterial( {
			color: 0x222222,
			metalness: 0.3,
			roughness: 0.3
		} );

		const blackWindow = new THREE.MeshPhysicalMaterial( {
					color: 0x000000, metalness: 0.25, roughness: 0, transmission: 1.0
				} );

		const blackPaint =  new THREE.MeshStandardMaterial( {
				color: 0x444444,
				metalness: 0.1,
				roughness: 0.1,
			} );

		const blackPaint_02 =  new THREE.MeshStandardMaterial( {
				color: 0x444444,
				metalness: 0.9,
				roughness: 0.6,
			} );

		const silverPaint =  new THREE.MeshStandardMaterial( {
				color: 0xEEEEEE,
				metalness: 0.1,
				roughness: 0.1,
			} );

		const silverPaint_02 =  new THREE.MeshStandardMaterial( {
				color: 0x666666,
				metalness: 0.9,
				roughness: 0.1,
			} );

		const silverPaint_03 = new THREE.MeshStandardMaterial( { 
				color:  0x666666,	
			} );

	
		
			

		

		let camera, scene, renderer, stats;
		let idleTime=0;

		let deltaTime=0;

		const clock = new THREE.Clock();

		let mixer;

		let modelChild_0, modelChild_1, modelChild_2, modelChild_3, modelChild_4, modelChild_5, modelChild_6, modelChild_7, modelChild_8, modelChild_9, modelChild_10, modelChild_11, modelChild_12, modelChild_13, modelChild_14, modelChild_15, modelChild_16, modelChild_17, modelChild_18, modelChild_19, modelChild_20, modelChild_21, modelChild_22;

		let scanChild_0, scanChild_1, scanChild_2, scanChild_3, scanChild_4, scanChild_5, scanChild_6, scanChild_7, scanChild_8, scanChild_9, scanChild_10, scanChild_11, scanChild_12, scanChild_13, scanChild_14, scanChild_15, scanChild_16, scanChild_17, scanChild_18, scanChild_19, scanChild_20, scanChild_21, scanChild_22;

		let frontLight, rearLight;

		let scan_frontLight, scan_rearLight;

		let engine_modeleChild_0, engine_modeleChild_1, engine_modeleChild_2, engine_modeleChild_3;

		let scan_engine_0, scan_engine_1, scan_engine_2, scan_engine_3;
		
		let wheel_modelChild_0, wheel_modelChild_1, wheel_modelChild_2, wheel_modelChild_3, wheel_modelChild_4, wheel_modelChild_5, wheel_modelChild_6, wheel_modelChild_7, wheel_modelChild_8, wheel_modelChild_9, wheel_modelChild_10, wheel_modelChild_11, wheel_modelChild_12, wheel_modelChild_13, wheel_modelChild_14;

		let scan_wheel_0, scan_wheel_1, scan_wheel_2, scan_wheel_3, scan_wheel_4, scan_wheel_5, scan_wheel_6, scan_wheel_7, scan_wheel_8, scan_wheel_9, scan_wheel_10, scan_wheel_11, scan_wheel_12, scan_wheel_13, scan_wheel_14;

		let chair_modelChild_0, chair_modelChild_1, chair_modelChild_2, chair_modelChild_3, chair_modelChild_4, chair_modelChild_5, chair_modelChild_6, chair_modelChild_7, chair_modelChild_8;

		let scan_chair_0, scan_chair_1, scan_chair_2, scan_chair_3, scan_chair_4, scan_chair_5, scan_chair_6, scan_chair_7, scan_chair_8;

		let wheel_FL = new THREE.Object3D();
		let wheel_FR = new THREE.Object3D();
		let wheel_RR = new THREE.Object3D();

		let chair_01_3D = new THREE.Object3D();
		let chair_02_3D = new THREE.Object3D();
		let scan_chair_01_3D = new THREE.Object3D();
		let scan_chair_02_3D = new THREE.Object3D();

		let car_3D = new THREE.Object3D();
		let scan_car_3D = new THREE.Object3D();

		let tire_3D = new THREE.Object3D();	
		let tireDIY_3D = new THREE.Object3D();
		let engine_3D = new THREE.Object3D();
		let scan_engine_3D = new THREE.Object3D();

		let wheel_3D = new THREE.Object3D();
		let wheel_3D_group = new THREE.Object3D();

		let scan_wheel_3D = new THREE.Object3D();
		let scan_wheel_FL = new THREE.Object3D();
		let scan_wheel_FR = new THREE.Object3D();
		let scan_wheel_RR = new THREE.Object3D();
		let scan_wheel_3D_group = new THREE.Object3D();

			
		let camVerticalPivot = new THREE.Object3D();	
		let camHorizonPivot = new THREE.Object3D();
		let Zoomtarget = new THREE.Object3D();

		let torusMesh, planeMesh;
		let generatedCubeRenderTarget, hdrCubeRenderTarget;
		let hdrCubeMap;
		

		let targetRotationX=0;
		let targetRotationY=0;

		let deltaXvalue=0;
		let deltaYvalue=0;
		let CamHeightAdjustor=0;

		let isMouseLeftPress=false;
		let IsScanModeOn=false;
		let IsIdleNow=false;
		let IsLableInfoOn=false;

		let colorIndex=1;

		let scan_model_offset=20;

			
		let IsAnimStart=true;
		let IsDetailOn=false;

		let Dot_01 = new THREE.Object3D();
		let Dot_02 = new THREE.Object3D();
		let Dot_03 = new THREE.Object3D();
		let Dot_04 = new THREE.Object3D();
		let Dot_05 = new THREE.Object3D();
		let Dot_06 = new THREE.Object3D();

		let ScanEffect_blue = new THREE.MeshBasicMaterial( { color: 0x0EAEAE, transparent: true, blending: THREE.AdditiveBlending, opacity:1 } );

		let ScanEffect_blue_02 = new THREE.MeshBasicMaterial( { color: 0x0EAEAE, transparent: true, blending: THREE.AdditiveBlending, opacity:0.1,wireframe: true} );

		let ScanEffect_orange = new THREE.MeshBasicMaterial( { color: 0xFF9900, transparent: true, blending: THREE.AdditiveBlending, opacity:1 } );


		let WireFrameEffect = new THREE.MeshNormalMaterial({wireframe: true});

		let ScanEffect_blue_03 =	new THREE.MeshBasicMaterial( { color: 0x006699, blending: THREE.AdditiveBlending, transparent: true, opacity: 0.3, side: THREE.DoubleSide } );

		let ScanEffect_white_01 =	new THREE.MeshBasicMaterial( { color: 0xffffff, blending: THREE.AdditiveBlending, transparent: true, opacity: 0.6, side: THREE.DoubleSide } );

		let ScanEffect_silver_01 =	new THREE.MeshBasicMaterial( { color: 0x000000,  blending: THREE.AdditiveBlending, transparent: true, opacity: 0.75, side: THREE.DoubleSide } );

		let ScanEffect_red_01 =	new THREE.MeshBasicMaterial( { color: 0x420000,  blending: THREE.AdditiveBlending, transparent: true, opacity: 1, side: THREE.DoubleSide } );

		let _sceneTag_01 = document.querySelector('#sceneTag_01');
		let _sceneTag_02 = document.querySelector('#sceneTag_02');
		let _sceneTag_03 = document.querySelector('#sceneTag_03');
		let _sceneTag_04 = document.querySelector('#sceneTag_04');
		let _sceneTag_05 = document.querySelector('#sceneTag_05');
		let _sceneTag_06 = document.querySelector('#sceneTag_06');


		let controls;

		
	</script>

	
	
	<script type="module">

		import * as THREE from 'three';

		import Stats from 'three/addons/libs/stats.module.js';

		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

		import { HDRCubeTextureLoader } from 'three/addons/loaders/HDRCubeTextureLoader.js';

		import { DebugEnvironment } from 'three/addons/environments/DebugEnvironment.js';
		
		import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';

		import { FontLoader } from 'three/addons/loaders/FontLoader.js';

		
		import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
		import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
		import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
		
		

		//document.write("/js/test.js");//引用外部的script

		//document.write("/js/FX_CameraController.js");


        init();
        animate();
		
		//WindowEventListenerInit();
		
		

function init() {

    
	const container = document.createElement( 'div' );
	document.body.appendChild( container );
	scene = new THREE.Scene();

	camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 2000 );
	camera.position.set(0,105,0);
	//camera.rotation.y=-Math.PI/2;
//	camera.lookAt(0,5,0);
//
//	camVerticalPivot.add(camera);
//	camHorizonPivot.add(camVerticalPivot);
//	Zoomtarget.copy(camera);
//
//	scene.add(camHorizonPivot).add(Zoomtarget);


	const ambientLight = new THREE.AmbientLight(0x666666,0.6);
	scene.add(ambientLight); 

    
	const hemiLight = new THREE.HemisphereLight( 0xFFFFFF, 0x000000, 1 ); //(上半球顏色,下半球顏色,強度)
	hemiLight.position.set( 0, 0, 0 );
	scene.add( hemiLight );

	renderer = new THREE.WebGLRenderer( { alpha: true, antialias: true } );
	renderer.setPixelRatio( window.devicePixelRatio );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.shadowMap.enabled = true;
	renderer.useLegacyLights = true;
	renderer.setClearColor(0x000000, 0.0);//需加入這一條，否則看不到CSS的底圖






	async function load_Audi_R8()
	{
		try{
		const model_scale = 6.6 ;
		const modelscale = new THREE.Vector3(model_scale,model_scale,model_scale);
		const modelPosition = new THREE.Vector3(0,-5,0);

		frontLight.position.set(0,0,-0.18);
		rearLight.position.set(0,0,0.12);
		
		car_3D.add(modelChild_0).add(modelChild_1).add(modelChild_2).add(modelChild_4).add(modelChild_5).add(modelChild_6).add(modelChild_7).add(modelChild_8).add(modelChild_9).add(modelChild_10).add(modelChild_11).add(modelChild_12).add(modelChild_13).add(modelChild_14).add(modelChild_15).add(modelChild_17).add(modelChild_18).add(modelChild_19).add(modelChild_20).add(modelChild_21).add(modelChild_22).add(frontLight).add(rearLight);

		scan_car_3D.add(scanChild_0).add(scanChild_1).add(scanChild_2).add(scanChild_4).add(scanChild_5).add(scanChild_6).add(scanChild_7).add(scanChild_8).add(scanChild_9).add(scanChild_10).add(scanChild_11).add(scanChild_12).add(scanChild_13).add(scanChild_14).add(scanChild_15).add(scanChild_16).add(scanChild_17).add(scanChild_18).add(scanChild_19).add(scanChild_20).add(scanChild_21).add(scanChild_22).add(scan_frontLight).add(scan_rearLight);

		scene.add(car_3D).add(scan_car_3D);

		car_3D.scale.copy(modelscale);
		car_3D.position.copy(modelPosition);
		car_3D.rotation.y=-Math.PI/2;

		scan_car_3D.scale.copy(modelscale);
		scan_car_3D.position.copy(new THREE.Vector3(modelPosition.x,modelPosition.y+scan_model_offset,modelPosition.z));
		scan_car_3D.rotation.y=-Math.PI/2;

		modelChild_0.material=blackWindow;//擋風玻璃
		modelChild_1.material=blackWindow;//後照鏡
		modelChild_2.material=silverPaint;//後logo
//		modelChild_3.materialWireFrameEffect前方無用的面，可刪
		modelChild_4.material=blackPaint;//前車牌
		modelChild_5.material=blackPaint_02;//
		modelChild_6.material=ScanEffect_red_01;//車尾燈
		modelChild_7.material=silverPaint;//後車牌
		modelChild_8.material=silverPaint_02;//排氣管
		modelChild_9.material=blackWindow;//水箱遮罩
		modelChild_10.material=blackPaint_02;
		modelChild_11.material=blackWindow;//後擋風玻璃
		modelChild_12.material=blackPaint_02;
		modelChild_13.material=blackWindow;//車窗
		modelChild_14.material=navyblue;//後車箱
		modelChild_15.material=blackPaint;//車門把手
		modelChild_16.material=WireFrameEffect;//車輪
		modelChild_17.material=silverPaint;//前logo
		modelChild_18.material=navyblue;//車身
		modelChild_19.material=blackPaint_02;
		modelChild_20.material=blackPaint_02;
		modelChild_21.material=ScanEffect_red_01;//車頭燈
		modelChild_22.material=blackPaint_02;
		
		frontLight.material=ScanEffect_white_01;
		rearLight.material=ScanEffect_orange;

		scanChild_0.material=ScanEffect_blue_02;
		scanChild_1.material=ScanEffect_blue_02;
		scanChild_2.material=ScanEffect_blue_02;
		scanChild_3.material=ScanEffect_blue_02;
		scanChild_4.material=ScanEffect_blue_02;
		scanChild_5.material=ScanEffect_blue_02;
		scanChild_6.material=ScanEffect_blue_02;
		scanChild_7.material=ScanEffect_blue_02;
		scanChild_8.material=ScanEffect_blue_02;
		scanChild_9.material=ScanEffect_blue_02;
		scanChild_10.material=ScanEffect_blue_02;
		scanChild_11.material=ScanEffect_blue_02;
		scanChild_12.material=ScanEffect_blue_02;
		scanChild_13.material=ScanEffect_blue_02;
		scanChild_14.material=ScanEffect_blue_02;
		scanChild_15.material=ScanEffect_blue_02;
		scanChild_16.material=ScanEffect_blue_02;
		scanChild_17.material=ScanEffect_blue_02;
		scanChild_18.material=ScanEffect_blue_02;
		scanChild_19.material=ScanEffect_blue_02;
		scanChild_20.material=ScanEffect_blue_02;
		scanChild_21.material=ScanEffect_blue_02;
		scanChild_22.material=ScanEffect_blue_02;

		scan_frontLight.material=ScanEffect_blue_02;
		scan_rearLight.material=ScanEffect_blue_02;
		}
		
		catch(e)
		{
			console.error(e); 
		}
	}


	const loadingManager_Audi_R8 = new THREE.LoadingManager(load_Audi_R8);
	// 導入3D模型
    

	const loader_Audi_R8 = new FBXLoader(loadingManager_Audi_R8);
	loader_Audi_R8.load( './3D/Audi_R8.fbx', 

		(object) => {

		//console.log(object);
		
		modelChild_0=object.children[0];
		modelChild_1=object.children[1];
		modelChild_2=object.children[2];
		modelChild_3=object.children[3];
		modelChild_4=object.children[4];
		modelChild_5=object.children[5];
		modelChild_6=object.children[6];
		modelChild_7=object.children[7];
		modelChild_8=object.children[8];
		modelChild_9=object.children[9];
		modelChild_10=object.children[10];
		modelChild_11=object.children[11];
		modelChild_12=object.children[12];
		modelChild_13=object.children[13];
		modelChild_14=object.children[14];
		modelChild_15=object.children[15];
		modelChild_16=object.children[16];
		modelChild_17=object.children[17];
		modelChild_18=object.children[18];
		modelChild_19=object.children[19];
		modelChild_20=object.children[20];
		modelChild_21=object.children[21];
		modelChild_22=object.children[22];

		frontLight=modelChild_21.clone();
		rearLight=modelChild_6.clone();

		scanChild_0=modelChild_0.clone();
		scanChild_1=modelChild_1.clone();
		scanChild_2=modelChild_2.clone();
		scanChild_3=modelChild_3.clone();
		scanChild_4=modelChild_4.clone();
		scanChild_5=modelChild_5.clone();
		scanChild_6=modelChild_6.clone();
		scanChild_7=modelChild_7.clone();
		scanChild_8=modelChild_8.clone();
		scanChild_9=modelChild_9.clone();
		scanChild_10=modelChild_10.clone();
		scanChild_11=modelChild_11.clone();
		scanChild_12=modelChild_12.clone();
		scanChild_13=modelChild_13.clone();
		scanChild_14=modelChild_14.clone();
		scanChild_15=modelChild_15.clone();
		scanChild_16=modelChild_16.clone();
		scanChild_17=modelChild_17.clone();
		scanChild_18=modelChild_18.clone();
		scanChild_19=modelChild_19.clone();
		scanChild_20=modelChild_20.clone();
		scanChild_21=modelChild_21.clone();
		scanChild_22=modelChild_22.clone();

		scan_frontLight=frontLight.clone();
		scan_rearLight=rearLight.clone();
		
		
    },
    (xhr) => {
        console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
    },
    (error) => {
        console.log(error)
    } );

	

	///Engine 3D///
	async function load_Car_Engine()
	{
		try{
			const model_scale = 0.08  ;
			const modelscale = new THREE.Vector3(model_scale,model_scale,model_scale);
			const modelPosition = new THREE.Vector3(16,2.5 ,0);
			
			
			engine_3D.add(engine_modeleChild_1);
			scan_engine_3D.add(scan_engine_1);
			scene.add(engine_3D);
			//scene.add(scan_engine_3D);
			
			engine_3D.position.copy(modelPosition);
			engine_3D.scale.copy(modelscale);
			engine_3D.rotation.y=Math.PI/2;
			
			scan_engine_3D.position.copy(new THREE.Vector3(modelPosition.x,modelPosition.y+scan_model_offset,modelPosition.z));
			scan_engine_3D.scale.copy(modelscale);
			scan_engine_3D.rotation.y=Math.PI/2;
		}
		
		catch(e)
		{
			console.error(e); 
		}

	}


	const loadingManager_Car_Engine = new THREE.LoadingManager(load_Car_Engine);
	// 導入3D模型
    

	const loader_Car_Engine = new FBXLoader(loadingManager_Car_Engine);
	loader_Car_Engine.load( './3D/Engine_20230806.fbx', 

		(object) => {

		//console.log(object);
		engine_modeleChild_0=object.children[0];
		engine_modeleChild_1=object.children[1];
		engine_modeleChild_2=object.children[2];
		engine_modeleChild_3=object.children[3];

		scan_engine_0=engine_modeleChild_0.clone();
		scan_engine_1=engine_modeleChild_1.clone();
		scan_engine_2=engine_modeleChild_2.clone();
		scan_engine_3=engine_modeleChild_3.clone();
    },
    (xhr) => {
        console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
    },
    (error) => {
        console.log(error)
    } );
	//////


		///Audi Wheel///
		async function load_Audi_Wheel()
	{
		try{
			const model_scale = 0.02  ;
			const modelscale = new THREE.Vector3(model_scale,model_scale,model_scale);
			const modelPosition = new THREE.Vector3(21.5, -5.85 ,13);

			wheel_3D.add(wheel_modelChild_1).add(wheel_modelChild_2).add(wheel_modelChild_3).add(wheel_modelChild_4).add(wheel_modelChild_5).add(wheel_modelChild_6).add	(wheel_modelChild_7).add(wheel_modelChild_8).add(wheel_modelChild_9).add(wheel_modelChild_10).add(wheel_modelChild_11).add(wheel_modelChild_12).add(wheel_modelChild_13).	add(wheel_modelChild_14);

			scan_wheel_3D.add(scan_wheel_1).add(scan_wheel_2).add(scan_wheel_3).add(scan_wheel_4).add(scan_wheel_5).add(scan_wheel_6).add(scan_wheel_7).add(scan_wheel_8).add	(scan_wheel_9).add(scan_wheel_10).add(scan_wheel_11).add(scan_wheel_12).add(scan_wheel_13).add(scan_wheel_14);

			wheel_FL=wheel_3D.clone();
			wheel_RR=wheel_3D.clone();
			wheel_FR=wheel_3D.clone();

			scan_wheel_FL=wheel_FL.clone();
			scan_wheel_RR=wheel_RR.clone();
			scan_wheel_FR=wheel_FR.clone();
			
			scene.add(wheel_3D).add(wheel_FL).add(wheel_RR).add(wheel_FR);
			//scene.add(scan_wheel_3D).add(scan_wheel_FL).add(scan_wheel_RR).add(scan_wheel_FR);



			wheel_3D.position.copy(modelPosition);
			wheel_3D.scale.copy(modelscale);
			wheel_3D.rotation.y=-Math.PI/2;

			wheel_FL.position.copy(new THREE.Vector3(-14.5, -5.85 ,13));
			wheel_FL.scale.copy(modelscale);
			wheel_FL.rotation.y=-Math.PI/2;

			wheel_RR.position.copy(new THREE.Vector3(20, -5.85 ,-13));
			wheel_RR.scale.copy(modelscale);
			wheel_RR.rotation.y=Math.PI/2;

			wheel_FR.position.copy(new THREE.Vector3(-16, -5.85 ,-13));
			wheel_FR.scale.copy(modelscale);
			wheel_FR.rotation.y=Math.PI/2;


			scan_wheel_3D.position.copy(new THREE.Vector3(modelPosition.x,modelPosition.y+scan_model_offset,modelPosition.z));
			scan_wheel_3D.scale.copy(modelscale);
			scan_wheel_3D.rotation.y=-Math.PI/2;

			scan_wheel_FL.position.copy(new THREE.Vector3(-14.5, modelPosition.y+scan_model_offset ,13));
			scan_wheel_FL.scale.copy(modelscale);
			scan_wheel_FL.rotation.y=-Math.PI/2;

			scan_wheel_RR.position.copy(new THREE.Vector3(20, modelPosition.y+scan_model_offset ,-13));
			scan_wheel_RR.scale.copy(modelscale);
			scan_wheel_RR.rotation.y=Math.PI/2;

			scan_wheel_FR.position.copy(new THREE.Vector3(-16, modelPosition.y+scan_model_offset ,-13));
			scan_wheel_FR.scale.copy(modelscale);
			scan_wheel_FR.rotation.y=Math.PI/2;

			scan_wheel_0.material=ScanEffect_blue_02;
			scan_wheel_1.material=ScanEffect_blue_02;
			scan_wheel_2.material=ScanEffect_blue_02;
			scan_wheel_3.material=ScanEffect_blue_02;
			scan_wheel_4.material=ScanEffect_blue_02;
			scan_wheel_5.material=ScanEffect_blue_02;
			scan_wheel_6.material=ScanEffect_blue_02;
			scan_wheel_7.material=ScanEffect_blue_02;
			scan_wheel_8.material=ScanEffect_blue_02;
			scan_wheel_9.material=ScanEffect_blue_02;
			scan_wheel_10.material=ScanEffect_blue_02;
			scan_wheel_11.material=ScanEffect_blue_02;
			scan_wheel_12.material=ScanEffect_blue_02;
			scan_wheel_13.material=ScanEffect_blue_02;
			scan_wheel_14.material=ScanEffect_blue_02;
		}

			catch(e)
		{
			console.error(e); 
		}
		
	}


	const loadingManager_Audi_Wheel = new THREE.LoadingManager(load_Audi_Wheel);
	// 導入3D模型
    

	const loader_Audi_Wheel = new FBXLoader(loadingManager_Audi_Wheel);
	loader_Audi_Wheel.load( './3D/Audi_Wheel_20230819.fbx', 

		(object) => {

		//console.log(object);

		wheel_modelChild_0=object.children[0];
		wheel_modelChild_1=object.children[1];
		wheel_modelChild_2=object.children[2];
		wheel_modelChild_3=object.children[3];
		wheel_modelChild_4=object.children[4];
		wheel_modelChild_5=object.children[5];
		wheel_modelChild_6=object.children[6];
		wheel_modelChild_7=object.children[7];
		wheel_modelChild_8=object.children[8];
		wheel_modelChild_9=object.children[9];
		wheel_modelChild_10=object.children[10];
		wheel_modelChild_11=object.children[11];
		wheel_modelChild_12=object.children[12];
		wheel_modelChild_13=object.children[13];
		wheel_modelChild_14=object.children[14];
		

		scan_wheel_0=wheel_modelChild_0.clone();
		scan_wheel_1=wheel_modelChild_1.clone();
		scan_wheel_2=wheel_modelChild_2.clone();
		scan_wheel_3=wheel_modelChild_3.clone();
		scan_wheel_4=wheel_modelChild_4.clone();
		scan_wheel_5=wheel_modelChild_5.clone();
		scan_wheel_6=wheel_modelChild_6.clone();
		scan_wheel_7=wheel_modelChild_7.clone();
		scan_wheel_8=wheel_modelChild_8.clone();
		scan_wheel_9=wheel_modelChild_9.clone();
		scan_wheel_10=wheel_modelChild_10.clone();
		scan_wheel_11=wheel_modelChild_11.clone();
		scan_wheel_12=wheel_modelChild_12.clone();
		scan_wheel_13=wheel_modelChild_13.clone();
		scan_wheel_14=wheel_modelChild_14.clone();

    },
    (xhr) => {
        console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
    },
    (error) => {
        console.log(error)
    } );
	//////


	///Car Chair///
	async function load_Car_Chair()
	{
		try{
			const model_scale = 3  ;
			const modelscale = new THREE.Vector3(model_scale,model_scale,model_scale);
			const modelPosition = new THREE.Vector3(0, -0.5 ,5);

			chair_01_3D.add(chair_modelChild_0).add(chair_modelChild_1).add(chair_modelChild_2).add(chair_modelChild_3).add(chair_modelChild_4).add(chair_modelChild_5).add	(chair_modelChild_6).add(chair_modelChild_7).add(chair_modelChild_8);

			scan_chair_01_3D.add(scan_chair_0).add(scan_chair_1).add(scan_chair_2).add(scan_chair_3).add(scan_chair_4).add(scan_chair_5).add(scan_chair_6).add(scan_chair_7).add	(scan_chair_8);

			scan_chair_0.material=ScanEffect_blue_02;
			scan_chair_1.material=ScanEffect_blue_02;
			scan_chair_2.material=ScanEffect_blue_02;
			scan_chair_3.material=ScanEffect_blue_02;
			scan_chair_4.material=ScanEffect_blue_02;
			scan_chair_5.material=ScanEffect_blue_02;
			scan_chair_6.material=ScanEffect_blue_02;
			scan_chair_7.material=ScanEffect_blue_02;
			scan_chair_8.material=ScanEffect_blue_02;

			chair_02_3D=chair_01_3D.clone();
			scan_chair_02_3D=scan_chair_01_3D.clone();

			scene.add(chair_01_3D).add(chair_02_3D).add(scan_chair_01_3D).add(scan_chair_02_3D);

			chair_01_3D.position.copy(modelPosition);
			chair_01_3D.scale.copy(modelscale);
			chair_01_3D.rotation.x=-Math.PI/2;
			chair_01_3D.rotation.z=Math.PI/2;

			chair_02_3D.position.copy(new THREE.Vector3(0, -0.5 ,-5));
			chair_02_3D.scale.copy(modelscale);
			chair_02_3D.rotation.x=-Math.PI/2;
			chair_02_3D.rotation.z=Math.PI/2;

			scan_chair_01_3D.position.copy(new THREE.Vector3(modelPosition.x,modelPosition.y+scan_model_offset,modelPosition.z));
			scan_chair_01_3D.scale.copy(modelscale);
			scan_chair_01_3D.rotation.x=-Math.PI/2;
			scan_chair_01_3D.rotation.z=Math.PI/2;

			scan_chair_02_3D.position.copy(new THREE.Vector3(0, modelPosition.y+scan_model_offset ,-5));
			scan_chair_02_3D.scale.copy(modelscale);
			scan_chair_02_3D.rotation.x=-Math.PI/2;
			scan_chair_02_3D.rotation.z=Math.PI/2;
		}

		catch(e)
		{
			console.error(e); 
		}
	
	}


	const loadingManager_Car_Chair = new THREE.LoadingManager(load_Car_Chair);
	// 導入3D模型
    

	const loader_Car_Chair = new FBXLoader(loadingManager_Car_Chair);
	loader_Car_Chair.load( './3D/Car_seat_complete_embedded_20230821.fbx', 

		(object) => {

		console.log(object);

		chair_modelChild_0=object.children[0];
		chair_modelChild_1=object.children[1];
		chair_modelChild_2=object.children[2];
		chair_modelChild_3=object.children[3];
		chair_modelChild_4=object.children[4];
		chair_modelChild_5=object.children[5];
		chair_modelChild_6=object.children[6];
		chair_modelChild_7=object.children[7];
		chair_modelChild_8=object.children[8];

		scan_chair_0=chair_modelChild_0.clone();
		scan_chair_1=chair_modelChild_1.clone();
		scan_chair_2=chair_modelChild_2.clone();
		scan_chair_3=chair_modelChild_3.clone();
		scan_chair_4=chair_modelChild_4.clone();
		scan_chair_5=chair_modelChild_5.clone();
		scan_chair_6=chair_modelChild_6.clone();
		scan_chair_7=chair_modelChild_7.clone();
		scan_chair_8=chair_modelChild_8.clone();

    },
    (xhr) => {
        console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
    },
    (error) => {
        console.log(error)
    } );
	//////
	

	
	////////Lighting/////////

	const pointLight_01 = new THREE.PointLight( 0xffffff, 0.3 );
	const pointLight_02 = new THREE.PointLight( 0xffffff, 0.3 );
	const pointLight_03 = new THREE.PointLight( 0xffffff, 0.3 );
	const pointLight_04 = new THREE.PointLight( 0xffffff, 0.3 );
	
	pointLight_01.position.set(9,20,9);
	pointLight_02.position.set(9,20,-9);
	pointLight_03.position.set(-9,20,-9);
	pointLight_04.position.set(-9,20,-9);

	const directionalLight = new THREE.DirectionalLight( 0xffffff, 1.5 );
	directionalLight.position.set(10,20,30);

	const directionalLight_2 = new THREE.DirectionalLight( 0xffffff, 1.5 );
	directionalLight_2.position.set(-10,20,30);

	scene.add( directionalLight ).add( directionalLight_2);

	const targetObject = new THREE.Object3D(); 
	scene.add(targetObject);
	targetObject.position.set(0,0,0);
	directionalLight.target = targetObject;
	directionalLight_2.target = targetObject;

	scene.add( pointLight_01 ).add(pointLight_02).add(pointLight_03).add(pointLight_04);

	/////////////////////////////

    // stats
	//stats = new Stats();
	//container.appendChild( stats.dom );

    //把3D渲染效果加入網頁視窗中
	container.appendChild( renderer.domElement );


	//利用座標設定旋轉中心及鏡頭焦點，camera不須另外設定初始角度
	controls = new OrbitControls( camera, renderer.domElement );
	controls.enablePan = true;//右鍵平移效果
	controls.enableDamping = true;
	controls.dampingFactor =0.05;
	controls.maxDistance = 500;
	controls.target.set( 0, 10, 0 );
	controls.zoomSpeed=0;
	controls.update();


		/////////3D lable/////////
	

	Dot_01.position.set(15,9+scan_model_offset,0);//engine 3D
	Dot_02.position.set(-21,10+scan_model_offset,0);
	Dot_03.position.set(3,7.5+scan_model_offset,-4.5);//chair 3D
	Dot_04.position.set(-16,4+scan_model_offset,-12);//wheel 3D
	Dot_05.position.set(30,8+scan_model_offset,-8);
	Dot_06.position.set(0,2+scan_model_offset,10);//car 3D

	

	scene.add(Dot_01).add(Dot_02).add(Dot_03).add(Dot_04).add(Dot_05).add(Dot_06);


	


	//////EventListener//////

	window.addEventListener( 'resize', onWindowResize );

	document.addEventListener('keydown', event => {
  
	  switch (event.keyCode)
	 { 
		case 32://spacebar

		//targetPosition=new THREE.Vector3(0,90,0);

		break;

		case 37://left arrow
		//console.log("left arrow");
		
		break;

		case 38://up arrow
		//console.log("up arrow");
		
		break;

		case 39: //right arrow
		//console.log("right arrow");
		break;


	 }

	})

	window.addEventListener("pointerdown", (event) => {
			
		targetPosition=null;
			
	});
}

function onWindowResize() {

	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();

	renderer.setSize( window.innerWidth, window.innerHeight );
	//composer.setSize( window.innerWidth, window.innerHeight );

}


//類似Unity的Update()功能
function animate() {

	requestAnimationFrame( animate );
	
	renderer.render( scene, camera );

	controls.update();
	
	//stats.update();

    const delta = clock.getDelta();

	if ( mixer ) mixer.update( delta );

	
		SetupSceneTag();
		
		CameraRotation(camera);

	}

	function ScreenPosLable(target,lable,targetCam)  
	{
		var width = window.innerWidth, height = window.innerHeight;
	    var widthHalf = width / 2, heightHalf = height / 2;
	
		var _target=target;
		var _lable=lable;
		var _targetCam=targetCam;
	    var pos_3D = _target.position.clone();
	    pos_3D.project(_targetCam);
	    pos_3D.x = ( pos_3D.x * widthHalf ) + widthHalf;
	    pos_3D.y = - ( pos_3D.y * heightHalf ) + heightHalf;

		_lable.style.cssText = `position:absolute;top:${pos_3D.y/height*100}%;left:${pos_3D.x/width*100}%;`;

	}
	
	function SetupSceneTag()
	{
		ScreenPosLable(Dot_01,_sceneTag_01,camera); 
		//ScreenPosLable(Dot_02,_sceneTag_02,camera); 
		ScreenPosLable(Dot_03,_sceneTag_03,camera); 
		ScreenPosLable(Dot_04,_sceneTag_04,camera); 
		//ScreenPosLable(Dot_05,_sceneTag_05,camera); 
		ScreenPosLable(Dot_06,_sceneTag_06,camera); 
	}



	function CameraRotation(thisCamera)
	{
	    const t = 0.03; 

	    if(targetPosition!=null)
	    {
	        if(thisCamera.position.distanceTo(targetPosition)>1)
	        {
	            thisCamera.position.lerpVectors(thisCamera.position,targetPosition,t);
	        }

	        else
	        {
	            targetPosition=null;
	        }
	    }
	}

	</script>


<script>

function CameraAnim(i)
{
	switch(i)
    {
		case 0:
		targetPosition=new THREE.Vector3(0,45,90);
		break;

		case 1:
		targetPosition=new THREE.Vector3(0,105,0);
		break;

	}
}

	
</script>



	

	</body>
</html>
