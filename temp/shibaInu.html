<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width", initial-scale="1.0"/>
		<meta http-equiv="X-UA-Compatible" content="ie=edge"/>
		<title>Shiba Inu</title>
		
		<style type="text/css">
			
			body
			{
				margin: 0;
				padding:0; 
				overflow: hidden;
			}
			

			canvas
			{
				width: 100%;
   				height: 100%;
			}


		</style>

        
	</head>
	
	<body> 
		
	<script src="js/three.js"></script> 

	<script src="js/levelManager.js"></script> 

	<script src="js/materials.js"></script> 
	 
	<script type="importmap">
		{
			"imports": {
				"three": "./build/three.module.js",				
				"three/addons/": "./jsm/"             
			}
		}

		
		
	</script>
	
	
	<script type="module">

		import * as THREE from 'three';

		import Stats from 'three/addons/libs/stats.module.js';

		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
		
		import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';
	

let camera, scene, renderer, stats;

let ShibaInu_3D = new THREE.Object3D();

let PosAdjuster = new THREE.Object3D();

let modelChild_0, modelChild_1, modelChild_2, modelChild_3, modelChild_4, modelChild_5, modelChild_6, modelChild_7, modelChild_8, modelChild_9, modelChild_10, modelChild_11, modelChild_12, modelChild_13, modelChild_14, modelChild_15, modelChild_16, modelChild_17;

let onFloor=true;




init();
animate();




function init() {

	const container = document.createElement( 'div' );
	document.body.appendChild( container );

	camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
	camera.position.set( 0, 3, 6 );	
    camera.lookAt(0,0,0);

	scene = new THREE.Scene();

//	scene.background = new THREE.Color( 0xbfe3dd );
	//scene.fog = new THREE.Fog( 0xa0a0a0, 200, 1000 ); 
	
    const ambientLight = new THREE.AmbientLight(0xFFF2CC,0.9);
	scene.add(ambientLight); 

    
	const hemiLight = new THREE.HemisphereLight( 0xFFF2CC, 0x000000, 1 ); //(上半球顏色,下半球顏色,強度)
	hemiLight.position.set( 0, 200, 0 );
	//scene.add( hemiLight );

	const dirLight = new THREE.DirectionalLight( 0xFFFFFF, 0.3 );
	dirLight.position.set( -100, 200, 100 );
	dirLight.castShadow = true;
	dirLight.shadow.camera.top = 180;
	dirLight.shadow.camera.bottom = - 100;
	dirLight.shadow.camera.left = - 120;
	dirLight.shadow.camera.right = 120;
	//scene.add( dirLight );
    //scene.add( new THREE.CameraHelper( dirLight.shadow.camera ) );
	

	renderer = new THREE.WebGLRenderer( { alpha: true, antialias: true } );
	renderer.setPixelRatio( window.devicePixelRatio );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.shadowMap.enabled = true;
	renderer.setClearColor(0x000000, 0.0);//需加入這一條，否則看不到CSS的底圖
	

	document.body.appendChild(renderer.domElement);

	function load_ShibaInu()
	{
		const model_scale = 0.005 ;
		const modelscale = new THREE.Vector3(model_scale,model_scale,model_scale);
		const modelPosition = new THREE.Vector3(0,0,0);

		PosAdjuster.add(modelChild_0).add(modelChild_1).add(modelChild_2).add(modelChild_3).add(modelChild_4).add(modelChild_5).add(modelChild_6).add(modelChild_7).add(modelChild_8).add(modelChild_9).add(modelChild_10).add(modelChild_11).add(modelChild_12).add(modelChild_13).add(modelChild_14).add(modelChild_15).add(modelChild_16).add(modelChild_17);

		PosAdjuster.position.set(0,-15,50);//將模型調整至正畫面中央

		ShibaInu_3D.add(PosAdjuster);
		scene.add(ShibaInu_3D);
		

		ShibaInu_3D.scale.copy(modelscale);
		ShibaInu_3D.position.copy(modelPosition);
		ShibaInu_3D.position.copy(modelscale);
		
	//	monstera_3d.rotation.y=-Math.PI/4;
//
	//	modelChild_1.position.copy(modelPosition);
	//	modelChild_1.scale.copy(modelscale);

		modelChild_0.visible=true;
		modelChild_1.visible=false;
		modelChild_2.visible=false;
		modelChild_3.visible=true;
		modelChild_4.visible=true;
		modelChild_5.visible=true;
		modelChild_6.visible=true;
		modelChild_7.visible=true;
		modelChild_8.visible=false;
		modelChild_9.visible=false;
		modelChild_10.visible=false;
		modelChild_11.visible=false;
		modelChild_12.visible=false;
		modelChild_13.visible=false;
		modelChild_14.visible=true;
		modelChild_15.visible=true;
		modelChild_16.visible=true;
		modelChild_17.visible=true;

		
		
	}


	const loadingManager_ShibaInu = new THREE.LoadingManager(load_ShibaInu);
	// 導入3D模型
    

	const loader_ShibaInu = new FBXLoader(loadingManager_ShibaInu);
	loader_ShibaInu.load( './3D/ShibaInu_20220311.fbx', 

		(object) => {

		console.log(object.children[1].children[0]);
		modelChild_0=object.children[1].children[0].children[0];
		modelChild_1=object.children[1].children[0].children[1];
		modelChild_2=object.children[1].children[0].children[2];
		modelChild_3=object.children[1].children[0].children[3];
		modelChild_4=object.children[1].children[0].children[4];
		modelChild_5=object.children[1].children[0].children[5];
		modelChild_6=object.children[1].children[0].children[6];
		modelChild_7=object.children[1].children[0].children[7];
		modelChild_8=object.children[1].children[0].children[8];
		modelChild_9=object.children[1].children[0].children[9];
		modelChild_10=object.children[1].children[0].children[10];
		modelChild_11=object.children[1].children[0].children[11];
		modelChild_12=object.children[1].children[0].children[12];
		modelChild_13=object.children[1].children[0].children[13];
		modelChild_14=object.children[1].children[0].children[14];
		modelChild_15=object.children[1].children[0].children[15];
		modelChild_16=object.children[1].children[0].children[16];
		modelChild_17=object.children[1].children[0].children[17];

		
		
    },
    (xhr) => {
        console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
    },
    (error) => {
        console.log(error)
    } );
	
	//利用座標設定旋轉中心及鏡頭焦點，camera不須另外設定初始角度
	//const controls = new OrbitControls( camera, renderer.domElement );
	//controls.enablePan = true;//右鍵平移效果
	//controls.enableDamping = true;
	//controls.dampingFactor =1.5;
	//controls.maxDistance = 1200;
	//controls.target.set( 0, 0, 0 );
	//controls.zoomSpeed=4;
	//controls.update();
    
  
	container.appendChild( renderer.domElement );


	window.addEventListener( 'resize', onWindowResize );

	// stats
	stats = new Stats();
	//container.appendChild( stats.dom );
	
}

function onWindowResize() {

	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();

	renderer.setSize( window.innerWidth, window.innerHeight );

}


//類似Unity的Update()功能
function animate() {

	requestAnimationFrame( animate );

	const delta = clock.getDelta();

	if ( mixer ) mixer.update( delta );

	renderer.render( scene, camera );

	stats.update();

	deltaTime=delta*0.3;

	if(ShibaInu_3D.position.y<0.2)
	{
		ShibaInu_3D.translateY(deltaTime);
	}

	if(ShibaInu_3D.position.y>0.1)
	{
		ShibaInu_3D.position.set(0,0,0);
	}	

}











	</script>



	</body>
	
</html>
