<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width", initial-scale="1.0"/>
		<meta http-equiv="X-UA-Compatible" content="ie=edge"/>
		<title>F0034</title>
		
		<style type="text/css">
		@import url('https://fonts.googleapis.com/css?family=Roboto:100,300,700');  
		@import url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" );
			
			body
			{
				margin: 0;
				padding:0; 
				overflow: hidden;
			}
			

			canvas
			{
				width: 100%;
   				height: 100%;
			}

		</style>

        
	</head>
	
	<body> 

	<script type="importmap">
		{
			  "imports": {
				"three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
				"three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
			  }
		}
	</script>


	
	
	
	<script type="module">

		import * as THREE from 'three';

		import Stats from 'three/addons/libs/stats.module.js';

		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

		import { FontLoader } from 'three/addons/loaders/FontLoader.js';

		import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
		import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
		import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

	

let camera, scene, renderer, stats, controls;

let moving=1;

let ScanEffect = new THREE.MeshBasicMaterial( { color: 0x3AAE07, blending: THREE.AdditiveBlending, transparent: true, opacity: 0.9, side: THREE.DoubleSide} );



let composer;

const params_post = {
		threshold: 0.1,
		strength: 1.5,
		radius: 1,
		exposure: 3
	};

const clock = new THREE.Clock();

let mixer;

const raycaster = new THREE.Raycaster();
const pointer = new THREE.Vector2();
let INTERSECTED;

let title='H\nE\nL\nL\nO\nW\nO\nR\nL\nD\nI\nA\nM\nF\nI\nM\nA\nW\nO\nR\nK';

let title_02='3\nD\nW\nE\nB\nS\nI\nD\nE\nD\nE\nS\nI\nG\nN\nS\nT\nU\nD\nI\nO';

let title_03='I\nN\nD\nU\nS\nT\nR\nI\nA\nL\nD\nE\nS\nI\nG\nN\nX\nI\nN\nT\nE\nA\nC\nT\nI\nV\nE\nD\nE\nS\nI\nG\nN';

let model_holder=new THREE.Object3D();
let model_holder_02=new THREE.Object3D();
let text,text_02,text_03;
var _new_text = document.getElementById("new_text");
let speed=1;
let num=0;


function ResetText()
{
	let reset_text_value=_new_text.value.split('').join(`\n`);

	title=reset_text_value;

	title_02=reset_text_value;

	title_03=reset_text_value;

	_new_text.value='';
}


init();
animate();
//RainTextAnim();

TiggerRainTextAnim();

function init() {

	const container = document.createElement( 'div' );
	document.body.appendChild( container );

	camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
	camera.position.set( 0, -15, 0 );	

	scene = new THREE.Scene();

	renderer = new THREE.WebGLRenderer({  alpha: true, antialias: true  });
	renderer.setPixelRatio( window.devicePixelRatio );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.shadowMap.enabled = true;
	renderer.setClearColor(0xFFFFFF, 0.03);//需加入這一條，否則看不到CSS的底圖
	
	document.body.appendChild(renderer.domElement);

	scene.add(model_holder).add(model_holder_02);


	
	//end load function

	//利用座標設定旋轉中心及鏡頭焦點，camera不須另外設定初始角度
	controls = new OrbitControls( camera, renderer.domElement );
	controls.enablePan = false;//右鍵平移效果
	controls.enableDamping = false;
	controls.enableRotate = false;
	controls.dampingFactor =1.5;
	controls.maxDistance = 1200;
	controls.target.set( 0, 0, 0 );
	controls.zoomSpeed=4;
	controls.update();


	//////PostProcessing/////

		//////PostProcessing/////

	const renderScene = new RenderPass( scene, camera );

	const bloomPass = new UnrealBloomPass( new THREE.Vector2( window.innerWidth, window.innerHeight ), 1.5, 0.4, 0.85 );
	bloomPass.threshold = params_post.threshold;
	bloomPass.strength = params_post.strength;
	bloomPass.radius = params_post.radius;
	bloomPass.exposure = params_post.exposure;

	composer = new EffectComposer( renderer );
	composer.addPass( renderScene );
	composer.addPass( bloomPass );

	container.appendChild( renderer.domElement );

	window.addEventListener( 'resize', onWindowResize );
}

function onWindowResize() {

	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();

	renderer.setSize( window.innerWidth, window.innerHeight );
	composer.setSize( window.innerWidth, window.innerHeight );
}


//類似Unity的Update()功能
function animate() {

	requestAnimationFrame( animate );

	const delta = clock.getDelta();

	if ( mixer ) mixer.update( delta );

	//renderer.render( scene, camera );

	composer.render();

	controls.update();

	if(num>10)
	{
		speed=0.01;
	}

	for(let i=0;i<model_holder.children.length;i++)
 	{
		if(model_holder.children[i]!=null)
		{
			model_holder.children[i].position.y-=0.1*speed;

			if(model_holder.children[i].position.y<-15)
			{
				let posX;
				let min = Math.ceil(-15);
    			let max = Math.floor(15);
    			posX=Math.floor(Math.random() * (max - min + 1) + min); //The maximum is inclusive and 			the minimum is inclusive
				model_holder.children[i].position.set(posX, 50 ,Math.floor(Math.random() * (5 - (-5) + 1) + (-5)));

				num++;
			}
		}
 	}

	for(let j=0;j<model_holder_02.children.length;j++)
 	{
		if(model_holder_02.children[j]!=null)
		{
			model_holder_02.children[j].position.y-=0.15*speed;

			if(model_holder_02.children[j].position.y<-15)
			{
				let posX;
				let min = Math.ceil(-15);
    			let max = Math.floor(15);
    			posX=Math.floor(Math.random() * (max - min + 1) + min); //The maximum is inclusive and 			the minimum is inclusive
				model_holder_02.children[j].position.set(posX, 50 ,Math.floor(Math.random() * (5 - (-5) + 1) + (-5)));

				num++;
			}
		}
 	}
}

function instText(content)
{
	const loader = new FontLoader();
	loader.load( './fonts/helvetiker_regular.typeface.json', function ( font ) {

	const message = content;
	const shapes = font.generateShapes( message, 0.2 );//字體大小
	const geometry = new THREE.ShapeGeometry( shapes );
	geometry.computeBoundingBox();
	const xMid = - 0.5 * ( geometry.boundingBox.max.x - geometry.boundingBox.min.x );
	geometry.translate( xMid, 0, 0 );
	// make shape ( N.B. edge view not visible )
	text = new THREE.Mesh( geometry, ScanEffect);
	text.position.set(0,1000,0);
	//scene.add( text );

	let posX;
	let min = Math.ceil(-15);
    let max = Math.floor(15);
    posX=Math.floor(Math.random() * (max - min + 1) + min); //The maximum is inclusive and the minimum is inclusive

	let random_index=Math.floor(Math.random() * (2 - 1 + 1) + 1);

	text.position.set(posX, 50 ,Math.floor(Math.random() * (3 - (-3) + 1) + (-3)));

	if(random_index===1)
	{
		model_holder.add(text);
	}
				
	else
	{
		model_holder_02.add(text);
	}

	} );
}

function TiggerRainTextAnim()
{
	setTimeout(() => {RainTextAnim(title);}, 1000);
	setTimeout(() => {RainTextAnim(title_02);}, 2000);
	setTimeout(() => {RainTextAnim(title_03);}, 3000);
	setTimeout(() => {RainTextAnim(title);}, 4000);
	setTimeout(() => {RainTextAnim(title_02);}, 5000);
	setTimeout(() => {RainTextAnim(title_03);}, 6000);
}

function RainTextAnim(_content)
{
	for(let i=0;i<5;i++)
	{
		instText(_content);
	}
}

</script>

	</body>
	
</html>
